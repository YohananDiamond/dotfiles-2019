" Vim Test File
" Author: YohananDiamond
" Repository: https://github.com/YohananDiamond/dotfiles

""""""""""""""""""""""""""""""""""""""""""""""""""""""""

set nocompatible
execute pathogen#infect()

" Initial Variables
let g:Config = {}
let g:Config.InitPath = resolve(expand('<sfile>:p:h'))

" Set up import and reload commands
command! -nargs=1 Import
    \ if isdirectory('C:\') | let s:extra = '/vimfiles' | else | let s:extra = '' | endif |
	\ exec 'source ' . g:Config.InitPath . s:extra . "/" . eval(<f-args>) . '.vim'
command! -nargs=0 Reload
	\ source $MYVIMRC

" GUI or not
if has('gui_running')
    set guioptions=agit

    if !isdirectory('C:\')
        let &guifont='Fira Code 10.5,Cascadia Code 10.5,Consolas 12,Monospace 12'
    else
        let &guifont='Fira Code:h10.5,Cascadia Code:h10.5,Consolas:h12,monospace:h12'
    endif
endif

" Python
if has('python3')
    let g:deoplete#enable_at_startup = 1
endif

" Set status line settings (when not using lightline)
if isdirectory('C:\')
    set statusline=\ %f
    set statusline+=%=
    set statusline+=\ %{&fileencoding?&fileencoding:&encoding}
    set statusline+=\ [%{&fileformat}\]\ 
    set statusline+=\ %p%%\ 
    set statusline+=\ %l:%c
    set statusline+=\ 
endif

""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" <Editor settings & etc.>

syntax on
set backspace=indent,eol,start
set laststatus=2 " Enable status bar
set number relativenumber " Hybrid numbers on the left edge of the screen
set encoding=utf-8
set textwidth=0 wrapmargin=0 " Prevent physical linebreak
set wildmode=longest,list " Bash-like command completion
set hidden " Prevent quitting vim with :q & etc.
set autoindent " For keeping the same indentation level on new liens
set hlsearch incsearch " Highlight & increment
set virtualedit=
set display+=lastline
set linebreak
set wrap
set cursorline
set mouse=a " Enable mouse

" Commands
command! -nargs=0 WhitespaceMode set list!
command! -nargs=0 WrapMode set wrap!
command! -nargs=0 GitSync !echo "Syncing..." && git pull && git add . && git commit && git push

" Listchars
set listchars=tab:»\ 
set listchars+=space:·
set listchars+=extends:%
set listchars+=precedes:%
set listchars+=eol:$,
set listchars+=trail:~

filetype plugin indent on " Idk what is this but it seems to work.

" Set color theme
set background=dark
colorscheme edge

" Autocmds
autocmd BufNewFile,BufRead,BufEnter *.mq :set filetype=mq 
autocmd FileType mq :call OptSpaceIndentation(2) 
autocmd FileType mq :nnoremap <buffer><silent> <Leader>c I\# <esc>A #/<esc>
autocmd FileType python :nnoremap <buffer><silent> <Leader>c I#<esc>
autocmd FileType vim :nnoremap <buffer><silent> <Leader>c I"<esc>

""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" <Option Functions>

" Create function to set tab indentation
func! OptTabIndentation(size)
	let &tabstop=a:size
	let &shiftwidth=a:size
	set noexpandtab
endfunction

" Create function to set space indentation
func! OptSpaceIndentation(size)
	let &tabstop=a:size
	let &shiftwidth=a:size
	set expandtab
	set softtabstop=0
	set smarttab
endfunction

"""""""""""""""""""""""""""""""""""""""""""""""""""""""
" <Functions>

func! XReplace(...)
    let l:a = input('Replace> ')
    let l:b = input('Replace /' . l:a . '/ with> ')
    let l:c = input('One by one? [Y/n] ')
    if (l:c == 'Y') || (l:c == 'y')
        let l:mode = 'gc'
    elseif (l:c == 'N') || (l:c == 'n')
        let l:mode = 'g'
    else
        let l:mode = 'g'
    endif
    exec '%s/' . l:a . '/' . l:b . '/' . l:mode
endfunc
command! -nargs=0 XReplace call XReplace()

"""""""""""""""""""""""""""""""""""""""""""""""""""""""
" <Keymappings>

let mapleader = ' '

" Switch between buffers
" nnoremap <silent> <C-x><right> :bn<CR>
" nnoremap <silent> <C-x><left> :bp<CR>
" inoremap <silent> <C-x><right> <C-o>:bn<CR>
" inoremap <silent> <C-x><left> <C-o>:bp<CR>
" tnoremap <silent> <C-x><right> <C-w>:bn<CR>
" tnoremap <silent> <C-x><left> <C-w>:bp<CR>
" vnoremap <silent> <C-x><right> <Esc>:bn<CR>
" vnoremap <silent> <C-x><left> <Esc>:bp<CR>
nnoremap <silent> <C-x>l :bn<CR>
nnoremap <silent> <C-x>h :bp<CR>
" inoremap <silent> <C-x>l <C-o>:bn<CR>
" inoremap <silent> <C-x>h <C-o>:bp<CR>
tnoremap <silent> <C-x>l <C-w>:bn<CR>
tnoremap <silent> <C-x>h <C-w>:bp<CR>
" vnoremap <silent> <C-x>l <Esc>:bn<CR>
" vnoremap <silent> <C-x>h <Esc>:bp<CR>
nnoremap <silent> <C-x>j :bn<CR>
nnoremap <silent> <C-x>k :bp<CR>
" inoremap <silent> <C-x>j <C-o>:bn<CR>
" inoremap <silent> <C-x>k <C-o>:bp<CR>
tnoremap <silent> <C-x>j <C-w>:bn<CR>
tnoremap <silent> <C-x>k <C-w>:bp<CR>
" vnoremap <silent> <C-x>j <Esc>:bn<CR>
" vnoremap <silent> <C-x>k <Esc>:bp<CR>

" Switch between tabs
" nnoremap <silent> <C-x>o :tabn<CR>
" nnoremap <silent> <C-x>k :tabp<CR>
" inoremap <silent> <C-x>o <C-o>:tabn<CR>
" inoremap <silent> <C-x>k <C-o>:tabp<CR>
" tnoremap <silent> <C-x>o <C-w>:tabn<CR>
" tnoremap <silent> <C-x>k <C-w>:tabp<CR>
" vnoremap <silent> <C-x>o <Esc>:tabn<CR>
" vnoremap <silent> <C-x>k <Esc>:tabp<CR>

" Mouse Wheel Scrolling
map <ScrollWheelUp> <C-U>
map <ScrollWheelDown> <C-D>

" Select all
nnoremap <silent> <space>a ggVG
vnoremap <silent> <space>a <Esc>ggVG

" Copy to registers
nnoremap <silent> <space>y "+y
nnoremap <silent> <space>p "+p
nnoremap <silent> <space>x "+x
vnoremap <silent> <space>y "+y
vnoremap <silent> <space>p "+p
vnoremap <silent> <space>x "+x

" Move by graphical, not physical line
nnoremap <silent> <Up> gk
nnoremap <silent> <Down> gj
vnoremap <silent> <Up> gk
vnoremap <silent> <Down> gj
nnoremap <silent> <End> g<End>
nnoremap <silent> <Home> g<Home>
vnoremap <silent> <End> g<End>
vnoremap <silent> <Home> g<Home>

" Indentation Management
nnoremap <silent> <Tab> >>
nnoremap <silent> <S-Tab> <<
vnoremap <silent> <Tab> >gv
vnoremap <silent> <S-Tab> <gv

" Plugin-related
nnoremap <silent> <space>xn :NERDTreeToggle<CR>

" Close split
nnoremap <silent> <space>x0 :close<CR>

" Clear search query
nnoremap <silent> <space>/ :noh<CR>

" Kill buffers
nnoremap <silent> <space>xk :b#<bar>bd#<CR>

" Use C-l on insert mode to go back to normal
inoremap <C-l> <Esc>

" Folding Commands
nnoremap <silent> <space><right> zO
nnoremap <silent> <space><left> zm
nnoremap <silent> <space>l zO
nnoremap <silent> <space>h zm

" Use ç/Ç on normal mode as comma
nmap Ç :
nmap ç ;

""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" <Plugin Settings>

" Lightline
let g:lightline = {
      \ 'active': {
      \   'left': [ [ 'mode', 'paste' ],
      \             [ 'readonly', 'filename' ] ],
      \ }}

" Space Indentation
call OptSpaceIndentation(4)
